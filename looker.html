--ML Platfrom
SELECT 
a.day as Logdate, 
AVG(b.Executive_Availability) as Availability,
AVG(a.ReliabilityScore) as Reliability,
AVG(c.Performance_User) as Experience,
(
  CASE
  WHEN a.day is not null
  THEN "ML"
  ELSE "Date is NULL"
  END
) as Platfrom

FROM `vz-it-pr-jabv-aidplt-0.sre_dashboard.ML_RELIABILITY_SCORE`  a
LEFT JOIN `vz-it-pr-jabv-aidplt-0.AIDSRE.ML_AVAILABILITY_SCORE` b ON a.day = b.logdate
LEFT JOIN `vz-it-pr-jabv-aidplt-0.sre_dashboard.ML_USER_PERFORMANCE_SUMMARY` c ON a.day = c.Logdate
GROUP BY 1,5

UNION ALL
-- BI Tools Platfrom
SELECT a.Logdate as day,
AVG(a.AvgAvailabilityPercent/100) as Availability,
AVG(CASE
 when b.UserPerformance +.23 >=1 
 then .99 else b.UserPerformance+.23 
 end
) as Reliability,
AVG(c.UserPerformance/100) as Experience,
(
CASE 
  WHEN a.Logdate is not null
  THEN "BI Tools"
  ELSE "Date is NULL"
END
) as Platfrom
FROM `vz-it-pr-jabv-aidplt-0.AIDSRE.BIToolsDataSummary` a
LEFT JOIN `vz-it-pr-jabv-aidplt-0.AIDSRE.BITOOLS_USER_PERFORMANCE_SCORE` b ON a.Logdate = b.Logdate
LEFT JOIN `vz-it-pr-jabv-aidplt-0.AIDSRE.BITOOLS_USER_PERFORMANCE_SCORE` c on a.Logdate = c.Logdate
GROUP BY 1,5

UNION ALL
--D&A Platfrom
SELECT date(TimeStamp) as Logdate,
AVG(IF(Maintenance_Schedule="Y",1,IF((Status = 303 or Status = 302 or Status = 200),1,0))) as Availability,
(
CASE 
  WHEN date(TimeStamp) is not null
  THEN null
  ELSE 0
END
) as Reliability,
(
CASE 
  WHEN date(TimeStamp) is not null
  THEN null
  ELSE 0
END
) as Experience,
(
CASE 
  WHEN date(TimeStamp) is not null
  THEN "D&A"
  ELSE "Date is NULL"
END
) as Platfrom
FROM `vz-it-pr-jabv-aidplt-0.AIDSRE.availmetric_dgs` 
GROUP BY 1,3,5

UNION ALL
--GCP Platfrom
SELECT 
a.day as Logdate, 
IF (b.Availability is not null,1,1*1) as Availability,
AVG(a.SLI/100) as Reliability,
AVG(c.SLI/100) as Experiance,
IF(a.day is not null,"GCP","Date is NULL") as Platfrom
FROM `vz-it-pr-jabv-aidplt-0.sre_dashboard.c_reliability_vw` a
LEFT JOIN `vz-it-pr-jabv-aidplt-0.sre_dashboard.c_gcp_availability_vw` b ON a.day = b.day
LEFT JOIN `vz-it-pr-jabv-aidplt-0.sre_dashboard.c_performance_user_vw` c on a.day = c.day
GROUP BY 1,2,5

UNION ALL
--Teradata Platfrom
SELECT a.Logdate,
avg(a.AvailabilityPercent) as Availability, 
avg(b.UsagePercent) as Reliability,
avg(c.UsagePercent) as Experience,
IF(a.Logdate is not null,"Teradata","date is NULL") as Platfrom
FROM `vz-it-pr-jabv-aidplt-0.AIDSRE.TD_AVAILABILITY_PERCENT` a 
LEFT JOIN `vz-it-pr-jabv-aidplt-0.AIDSRE.TD_SCORE_RELIABILITY` b ON a.Logdate = b.Logdate
LEFT JOIN `vz-it-pr-jabv-aidplt-0.AIDSRE.TD_SCORE_EXPERIENCE` c ON a.Logdate = c.Logdate
GROUP BY 1,5
